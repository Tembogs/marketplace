
generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


model User {
  id              String   @id @default(uuid())
  email           String   @unique
  passwordHash    String
  role            Role
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  requests        SupportRequest[] @relation("UserRequests")
  assigned        SupportRequest[] @relation("ExpertRequests")
  messages        Message[]
  expertProfile   ExpertProfile?
}

model ExpertProfile {
  id           String  @id @default(uuid())
  userId       String  @unique
  bio          String
  skills       String[]
  isAvailable  Boolean @default(true)
  rating       Float   @default(0)

  user         User    @relation(fields: [userId], references: [id])
}

model SupportRequest {
  id           String   @id @default(uuid())
  userId       String
  expertId     String?
  status       RequestStatus
  createdAt    DateTime @default(now())
  acceptedAt   DateTime?
  closedAt     DateTime?

  user         User     @relation("UserRequests", fields: [userId], references: [id])
  expert       User?    @relation("ExpertRequests", fields: [expertId], references: [id])
  messages     Message[]
  session      Session?
}

model Message {
  id           String   @id @default(uuid())
  requestId    String
  senderId     String
  content      String
  createdAt    DateTime @default(now())

  request      SupportRequest @relation(fields: [requestId], references: [id])
  sender       User           @relation(fields: [senderId], references: [id])
}

model Session {
  id           String   @id @default(uuid())
  requestId    String   @unique
  startedAt    DateTime @default(now())
  endedAt      DateTime?

  request      SupportRequest @relation(fields: [requestId], references: [id])
}

enum Role {
  USER
  EXPERT
  ADMIN
}

enum RequestStatus {
  REQUESTED
  ACCEPTED
  ACTIVE
  CLOSED
  CANCELLED
}
