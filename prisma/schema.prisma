
generator client {
  provider = "prisma-client-js"
  output   = "../src/generated"
}

datasource db {
  provider = "postgresql"
}




model User {
  id              String   @id @default(uuid())
  email           String   @unique
  name            String
  passwordHash    String
  role            Role     @default(USER)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  isOnline        Boolean  @default(false)
  reviewsReceived Review[] @relation("ExpertReviews")
  reviewsGiven    Review[] @relation("UserReviews")

  requests        SupportRequest[] @relation("UserRequests")
  assigned        SupportRequest[] @relation("ExpertRequests")
  messages        Message[]
  expertProfile   ExpertProfile?
}


model Skill {
  id      String @id @default(uuid())
  name    String
  expertId String

  expert ExpertProfile @relation(fields: [expertId], references: [id] )
}

model ExpertProfile {
  id           String  @id @default(uuid())
  userId       String  @unique
  bio          String
  skills       Skill[]
  isAvailable  Boolean @default(true)
  rating       Float   @default(0)

  user         User    @relation(fields: [userId], references: [id])
}

model SupportRequest {
  id           String   @id @default(uuid())
  userId       String
  expertId     String?
  status       RequestStatus
  createdAt    DateTime @default(now())
  acceptedAt   DateTime?
  closedAt     DateTime?
  review       Review?

  user         User     @relation("UserRequests", fields: [userId], references: [id])
  expert       User?    @relation("ExpertRequests", fields: [expertId], references: [id])
  messages     Message[]
  session      Session?
}

model Review {
  id          String   @id @default(uuid())
  rating      Int      // 1 to 5
  comment     String?
  requestId   String   @unique
  request     SupportRequest @relation(fields: [requestId], references: [id])
  expertId    String
  expert      User     @relation("ExpertReviews", fields: [expertId], references: [id])
  reviewerId  String
  reviewer    User     @relation("UserReviews", fields: [reviewerId], references: [id])
  createdAt   DateTime @default(now())
}

model Message {
  id           String   @id @default(uuid())
  requestId    String
  senderId     String
  content      String
  createdAt    DateTime @default(now())

  request      SupportRequest @relation(fields: [requestId], references: [id])
  sender       User           @relation(fields: [senderId], references: [id])
}

model Session {
  id           String   @id @default(uuid())
  requestId    String   @unique
  startedAt    DateTime @default(now())
  endedAt      DateTime?

  request      SupportRequest @relation(fields: [requestId], references: [id])
}

enum Role {
  USER
  EXPERT
  ADMIN
}

enum RequestStatus {
  REQUESTED
  ACCEPTED
  ACTIVE
  CLOSED
  CANCELLED
  COMPLETED
}
